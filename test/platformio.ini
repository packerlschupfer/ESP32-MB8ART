; PlatformIO configuration for MB8ART unit tests

[env:native]
platform = native
test_framework = unity
build_flags =
    -std=c++11
    -D UNIT_TEST
    -D MB8ART_LOG_LEVEL=0  ; Disable logging during tests
    -I ../src
    -I ../logger_submodule/src
    -I .  ; Include test directory for MockMB8ART.h

lib_deps =
    ; Add any required test dependencies

; Ignore hardware-specific libraries during native tests
lib_ignore =
    freertos
    esp32ModbusRTU
    
[env:esp32]
platform = espressif32
board = esp32dev
framework = arduino
test_framework = unity
build_flags =
    -D UNIT_TEST
    -D MB8ART_LOG_LEVEL=1  ; Minimal logging
    -I .  ; Include test directory for MockMB8ART.h

; Ignore libraries that aren't needed for unit tests
lib_ignore =
    ESP32-MQTTManager
    ESP32-EthernetManager
    ESP32-OTAManager
    ESP32-NTPClient
    ESP32-PersistentStorage
    ESP32-RuntimeStorage
    ESP32-TaskManager
    ESP32-DS3231Controller
    ESP32-SemaphoreGuard

lib_deps =
    ; The MB8ART library being tested (local path, excludes example dirs)
    symlink://../
    ; Production dependencies for hardware tests
    esp32ModbusRTU
    https://github.com/packerlschupfer/ESP32-ModbusDevice.git
    https://github.com/packerlschupfer/ESP32-MutexGuard.git
    https://github.com/packerlschupfer/ESP32-IDeviceInstance.git
    https://github.com/packerlschupfer/ESP32-LibraryCommon.git
    https://github.com/packerlschupfer/ESP32-Logger.git

upload_speed = 921600
monitor_speed = 115200
monitor_filters = esp32_exception_decoder